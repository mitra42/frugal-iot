; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html
; 
; Note the board name is defined in e.g. ~/.platformio/platforms/espressif32/boards/ttgo-lora32-v21.json
; and variants are in ~/.platformio/packages/framework-arduinoespressif32/variants/
; or ~/.platformio/packages/framework-arduinoespressif8266/variants


; custom common options

[platformio]
name: Frugal-IoT Agri
description: Frugal IoT - Agriculture Sensor with SHT (temp and humidity) DS18B30 (soil temp) and Soil moisture
src_dir = .
;This src_dir line should be present if your program is in xxx.ino or commented out if your program is in src/main.cpp

[common]
; These are flags common to pretty much all frugal-iot projects
; comment or uncomment debug flags based on need
build_flags_frugaliot =
    ;'-D LANGUAGE_DEFAULT="id"' ; Default language for portal (if not en) - de,nl,id currently supported
    -D SYSTEM_DISCOVERY_DEBUG
    -D SYSTEM_FRUGAL_DEBUG
    ;-D SYSTEM_LITTLEFS_DEBUG
    ;-D SYSTEM_MEMORY_DEBUG ; cos seeing intermittent crash after some period (>7 mins)
    -D SYSTEM_MQTT_DEBUG
    ;-D SYSTEM_OTA_DEBUG
    ;-D SYSTEM_POWER_DEBUG
    ;-D SYSTEM_SD_WANT ; Uses LittleFS by default
    ;-D SYSTEM_TIME_DEBUG
    -D SYSTEM_WIFI_DEBUG
    ;-D SYSTEM_WIFI_SCANPERIOD=50000        ; Slow down scanning so can easier debug captive portal
    ;-D CONTROL_BLINKEN_DEBUG
    ;-D CONTROL_LOGGERFS_DEBUG
    -D SENSOR_BATTERY_DEBUG
    ;-D SENSOR_BH1750_DEBUG
    ;-D SENSOR_DHT_DEBUG 
    ;-D SENSOR_ENSAHT_DEBUG
    ;-D SENSOR_LOADCELL_DEBUG
    ;-D SENSOR_MS5803_DEBUG
    -D SENSOR_SHT_DEBUG
    ;-D SENSOR_DS18B20_DEBUG
    ;-D SENSOR_SHT_ADDRESS=0x45 ; 0x44 (default) or 0x45 for D1 shields
    ;-D SENSOR_SOIL_DEBUG
    ;-D DEBUG_DNSSERVER ; If captive portal not seeing requests - as happening on ESP8266

; flags that apply only in main (the library can see them, but doesnt need them)
build_flags_main = 

; project specific flags that are needed by the library 
; - being phased out (apart from debug flags) in favor of parameters from main.cpp
; but may be used where impact is across files, especially temporarily, for example where refactoring
build_flags_library = 
    ; Specific to SHT 
    ; -D SENSOR_SHT_ADDRESS=0x45 ; 0x44 (default) or 0x45 for D1 shields (SHT4x default is also 0x44)
    '-D SYSTEM_OTA_PREFIX="agri"'

; build flags that only relate to boards with LoRaMesher
build_flags_loramesher = 
    ; LoRaMesher, for now, has a lot of flags here, will move some of this to main.cpp
    ; Both the t3_s3 and the ttgo boards we are testing use the same module
    ; feel free to move into per-board [env] (and submit a PR) if your own setup differs
    -D SYSTEM_LORAMESHER_BAND=915.0F ; 868.0F for Europe, 915.0F for US/AU; 433.0F for Asia
    -D SYSTEM_LORAMESHER_DEBUG ; to get debugging at the app (not LoRaMesher or Radio) layers
    ;-D CORE_DEBUG_LEVEL=5 ; To get lots of debugging out of LoraMesher
    ;-D RADIOLIB_DEBUG_BASIC ; Debugging from RadioLib 

; Flags specific to project, but vary across dev-boards or variants
build_flags = 
    ${common.build_flags_frugaliot}
    ${common.build_flags_main}
    ${common.build_flags_library}

lib_deps = 
    Frugal-IoT@^0.0.13
    ; Libraries specific to this hardware - sensor, actuator, etc
    ; robtillaart/SHT85 ; included by frugal-iot (in library.json & library.properties)
    
; selecting a platform for board descriotions
platform_esp32 = https://github.com/pioarduino/platform-espressif32/releases/download/stable/platform-espressif32.zip ; works in both PlatformIO and PIOArduino extensions
;platform_packages = framework-arduinoespressif32@3.3.2 ; also possible, but mostly unneeded and wont always work

[env]
monitor_speed = 460800 ; If not 460800 then also change in main.cpp: frugal_iot.startSerial(newspeed, 5000);
upload_speed = 460800
framework = arduino
; Unclear if next line causes problems either way - if commented out then doesnt recognize uploaded system 
board_build.filesystem = littlefs ; Use LittleFS instead of SPIFFS
lib_compat_mode = strict
lib_deps =  ${common.lib_deps}
lib_ldf_mode = chain
;Uncomment, if seeing exceptions need decoding
; build_type = debug
; monitor_filters = esp8266_exception_decoder
monitor_filters = esp32_exception_decoder

; This is a test unit with DS18B30 SHT40 SOIL and battery
[env:c3_pico_1]
platform = ${common.platform_esp32}
board = lolin_c3_mini ; use c3_mini board defs - but note define below which is special cased
board_build.variant = lolin_c3_pico
build_flags = 
    ${common.build_flags}
    '-D SYSTEM_OTA_SUFFIX="c3_pico_1"'
    -D ARDUINO_LOLIN_C3_PICO ; if using C3_PICO use lolin_c3_mini as board and define here
    ; PR submitted https://github.com/espressif/arduino-esp32/pull/11851
    ; Until then patched into variant file but if that is auto-updated, can define below
    ; Remvoe this comment when PR accepted, and new version of Arudino-esp32 gets installed
    ; See Home(bottom left)/Platforms/espresif32/updates (none as of 2025sep23 even though PR merged)
    ;-D RGB_BUILTIN_LED_COLOR_ORDER=LED_COLOR_ORDER_RGB
    -D SENSOR_SHT_SHT4x      ; Uncomment if using SHT4x series sensors (default is SHT3x)
    ;-D SYSTEM_POWER_DEBUG
    -D SENSOR_SOIL_PIN=4
    -D SENSOR_DS18B20_PIN=6
    -D SENSOR_BATTERY_PIN=3 ; Default battery pin is 3, defined in board file

board_build.partitions = min_spiffs.csv

; This is a test unit working with a power-pack that offers a separate lead to measure battery voltage. Here connected to pin 0
[env:c3_pico_2]
platform = ${common.platform_esp32}
board = lolin_c3_mini ; use c3_mini board defs - but note define below which is special cased
board_build.variant = lolin_c3_pico
build_flags = 
    ${common.build_flags}
    '-D SYSTEM_OTA_SUFFIX="c3_pico_2"'
    -D ARDUINO_LOLIN_C3_PICO ; if using C3_PICO use lolin_c3_mini as board and define here
    ; PR submitted https://github.com/espressif/arduino-esp32/pull/11851
    ; Until then patched into variant file but if that is auto-updated, can define below
    ; Remove this comment when PR accepted, and new version of Arudino-esp32 gets installed
    ; See Home(bottom left)/Platforms/espresif32/updates (none as of 2025sep23 even though PR merged)
    ;-D RGB_BUILTIN_LED_COLOR_ORDER=LED_COLOR_ORDER_RGB
    ;-D SYSTEM_POWER_DEBUG
    -D SENSOR_SOIL_PIN=4
    -D SENSOR_DS18B20_PIN=6
    -D SENSOR_BATTERY_PIN=0 ; Read battery voltage on pin 0 as its external (note pin 5 failed for some reason)
    -D SENSOR_BATTERY_VOLTAGE_DIVIDER=2 ; Power 1 & 2 are both 100k+100k
board_build.partitions = min_spiffs.csv

[env:s2_mini_1]
platform = ${common.platform_esp32}
board = lolin_s2_mini ; defines ARDUINO_LOLIN_S2_MINI variant=lolin_s2_mini
build_flags = 
    ${common.build_flags}
    '-D SYSTEM_OTA_SUFFIX="s2_mini_1"'
    ;-D SYSTEM_POWER_DEBUG
    -D SENSOR_SOIL_PIN=8 ; orange labeled A 
    -D SENSOR_DS18B20_PIN=6 ; yellow labeled B
    -D SENSOR_BATTERY_PIN=10 ; Read battery voltage on pin 5 as its external
    -D SENSOR_BATTERY_VOLTAGE_DIVIDER=2 ; Power 1 & 2 are both 100k+100k
    -D SENSOR_SHT_SHT4x      ; Uncomment if using SHT4x series sensors (default is SHT3x)
    -D SENSOR_DS18B20_DEBUG
    -D SENSOR_SOIL_DEBUG
    -D SENSOR_SHT_DEBUG
board_build.partitions = min_spiffs.csv

; To add another board, copy example from another examples/*/platform.ini and edit in pins etc.